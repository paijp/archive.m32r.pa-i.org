
# ご紹介 (2006/12/09)

m32r.pa-i.orgは、πが作成したフリーのM32R/Eプロセッサ用のソフトウェア・ハードウェアを公開するサイトです。

現在、仮運用中で、コンテンツの整備を進めている段階です。

申し訳ありませんが、今のところ連絡先は公開しておりません。お問い合わせフォームを準備中ですので、ご了承ください。

# 基本モニタ (2006/12/09)

OAKS32R用のモニタです。シリアルに接続されたターミナルからコマンドを入力することで、メモリ操作、メモリへのダウンロード、プログラムの実行、ジャンパスイッチによるプログラムの自動実行などができます。

##  機能

##  インストール方法

ビルドした後、OAKS32Rに添付のダウンローダを使って、フラッシュROMに書き込んでください。

##  使用方法

115.2kbpsのシリアルでボードに接続し、ジャンパ2をオープンにして電源を投入すると、プロンプトが表示されます。「h」でヘルプが表示されます。

ジャンパ2をショートして電源を投入すると、プロンプトを表示せずに実行を開始します。

# μITRON4.0仕様OS (2006/12/09)

OAKS-M32R用のμITRONです。DJ用CDプレーヤーで、外部バス上のSDRAMを使用せずにソフトウェアを動かす目的で開発しました。

##  機能

##  インストール方法

[モニタ] を使ってダウンロードしてください。

##  使用方法

プログラムとリンクして使用する構造のため、ダウンロードファイル自体はテストプログラムを含んでいます。

# DJ用CDプレーヤー (2006/12/09)

M32RのDSP機能を利用して可変ピッチ再生をおこなう、DJ用のツインCDプレーヤー+ミキサーです。

# Tips (2006/12/09)

M32Rの割り込みベクタをRAM上で書き換え可能にする方法です。フラッシュROMの書き込みに失敗して、起動不能になるリスクを避けることができます。

ICEなしでM32102を使用する場合、フラッシュROM上にある割り込みベクタの書き換えに失敗した場合に、リセットベクタが失われて起動不可能になる危険があります。SDRAMCを操作して、SDRAMをアドレス0に割り当てると、SDRAMアクセスはBSEL0よりも優先されるため、割り込みベクタのメモリ領域をSDRAMで上書きすることができます。ただしこのためには、SDRAMCをいったん停止する必要があり、リフレッシュが停止してSDRAMの内容が保証されなくなります。検証していませんが、SDRAMの後のアドレスにフラッシュROMのシャドーが見えていると思われますので、ここからSDRAMへのコピーが可能かも知れません。

# Tips (2006/12/09)

M32Rの外部waitを使用せずに、16bitの外部バスに対して長いセットアップタイムを確保する方法です。PLDのピンが足りなかったり、電圧が合わなかったりする場合に有効です。

M32102にATAを接続する場合、32bitアクセスを16bitアクセス2回に分割するダイナミック・バス・サイジングをうまく利用すると、少ないハードウェアで以下の問題に対応できます。

1つ目の問題は、ATAのPIOモード0で要求されている長いセットアップタイムが、バスコントローラの設定では実現できないことです。今回のシステムでは、コマンドアクセス用のBSEL4を32bitアクセスした場合には、分割された1回目のアクセス時にはRD・WRをアサートせずにCSを保持し、2回目のアクセスの時にRD・WRをアサートするようにしました。これにより、長いセットアップタイムが確保できます。ウェイト信号の不要な最高速度であるPIOモード2であれば、長いセットアップタイムはいらないので、これに切り替えたあとは、BSEL4の奇数アドレスを16bitアクセスすればPIOモード2のタイミングとなります。

もう1つの問題は、ATAは16bitバスであるため、DMAでSDRAMに転送するのに効率が悪いことです。これについては、データアクセス用のBSEL5を32bitアクセスした場合には、単純に16bitバスを2回読み込むようにしました。これにより、DMAで32bit転送すると、16bitが2回リードされて32bitとして書き込まれ、効率的です。

BSEL4とBSEL5は、RD・WRをアサートせずにCSを保持する機能だけが異なっており、アドレスマッピングなどは同一になっています。

# メインボード (2006/12/09)

DJ用CDプレーヤーのメインボードのプリント基板データです。

# 電源基板 (2006/12/09)

DJ用CDプレーヤーの電源の分配・モータドライブ用のプリント基板データです。

# 表示モジュール用 (2006/12/09)

DJ用CDプレーヤーの、FL管表示モジュール用のPIC16C84用のコードです。

# キースキャン用 (2006/12/09)

DJ用CDプレーヤーの、キースキャン・LED表示・AD変換などをおこなうPIC16C74用のコードです。

# スクラッチ用 (2006/12/09)

DJ用CDプレーヤーのスクラッチコントローラで、コイル駆動をおこなうPIC12C508用のコードです。
